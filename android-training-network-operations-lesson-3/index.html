
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Android Training - 执行网络操作(Lesson 3 - 解析XML数据) - 胡凯</title>
  <meta name="author" content="HuKai">

  
  <meta name="description" content="第3课:Parsing XML Data
Extensible Markup Language (XML) .很多网站或博客上都提供XML feed来记录更新的信息，以便用户进行订阅读取。 那么上传[?]与解析XML数据就成了app的一个常见的功能。 这一课会介绍如何解析XML文档并使用他们的数据 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://hukai.me/android-training-network-operations-lesson-3/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">

  <!--
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  -->
  <link href="/atom.xml" rel="alternate" title="胡凯" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<!--Mark by @Kesen-->
<!-- <link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css"> -->

  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-37679268-1', 'auto');
    ga('send', 'pageview');

  </script>



</head>

<body   class="no-sidebar"  >
  <header role="banner"><hgroup>
  <h1><a href="/">胡凯</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:hukai.me" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">首页</a></li>
  <li><a href="/blog/archives">存档</a></li>
  <li><a href="/android-training-course-in-chinese/index.html">Android官方培训课程</a></li>
  <li><a href="/about/me.html">关于胡凯</a></li>
  <li><a href="/about/friends.html">友情链接</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Android Training - 执行网络操作(Lesson 3 - 解析XML数据)</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-05-07T17:05:00+08:00" pubdate data-updated="true">May 7<span>th</span>, 2012</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p><strong>第3课:Parsing XML Data</strong>
Extensible Markup Language (XML) .很多网站或博客上都提供XML feed来记录更新的信息，以便用户进行订阅读取。</p>

<p>那么上传[?]与解析XML数据就成了app的一个常见的功能。 这一课会介绍如何解析XML文档并使用他们的数据。</p>

<p><em>([?]这里很奇怪，为什么是Upload，看文章最后一段代码示例的注释，应该是Download才对)</em></p>

<h2>Choose a Parser(选择一个解析器)</h2>

<p>我们推荐<a href="http://developer.android.com/reference/org/xmlpull/v1/XmlPullParser.html">XmlPullParser</a>, 它是在Android上一个高效且可维护的解析XML方法。 Android 上有这个接口的两种实现方式：</p>

<ul>
<li><a href="http://kxml.sourceforge.net/">KXmlParser</a> via <a href="http://developer.android.com/reference/org/xmlpull/v1/XmlPullParserFactory.html#newPullParser(">XmlPullParserFactory.newPullParser()</a>).</li>
<li>ExpatPullParser, via <a href="http://developer.android.com/reference/android/util/Xml.html#newPullParser(">Xml.newPullParser()</a>).</li>
</ul>


<p>两个选择都是比较好的。下面的示例中是使用ExpatPullParser, via Xml.newPullParser().</p>

<!-- more -->


<h2>Analyze the Feed(分析Feed)</h2>

<p>解析一个feed的第一步是决定需要获取哪些字段。这样解析器才去抽取出那些需要的字段而忽视剩下的。
下面一段章节概览Sample app中截取的一段代码示例.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
</span><span class='line'><span class="nt">&lt;feed</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/2005/Atom&quot;</span> <span class="na">xmlns:creativeCommons=</span><span class="s">&quot;http://backend.userland.com/creativeCommonsRssModule&quot;</span> <span class="err">...&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;title</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span><span class="nt">&gt;</span>newest questions tagged android - Stack Overflow<span class="nt">&lt;/title&gt;</span>
</span><span class='line'>...
</span><span class='line'>    <span class="nt">&lt;entry&gt;</span>
</span><span class='line'>    ...
</span><span class='line'>    <span class="nt">&lt;/entry&gt;</span>
</span><span class='line'>    <span class="nt">&lt;entry&gt;</span>
</span><span class='line'>        <span class="nt">&lt;id&gt;</span>http://stackoverflow.com/q/9439999<span class="nt">&lt;/id&gt;</span>
</span><span class='line'>        <span class="nt">&lt;re:rank</span> <span class="na">scheme=</span><span class="s">&quot;http://stackoverflow.com&quot;</span><span class="nt">&gt;</span>0<span class="nt">&lt;/re:rank&gt;</span>
</span><span class='line'>        <span class="nt">&lt;title</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span><span class="nt">&gt;</span>Where is my data file?<span class="nt">&lt;/title&gt;</span>
</span><span class='line'>        <span class="nt">&lt;category</span> <span class="na">scheme=</span><span class="s">&quot;http://stackoverflow.com/feeds/tag?tagnames=android&amp;sort=newest/tags&quot;</span> <span class="na">term=</span><span class="s">&quot;android&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;category</span> <span class="na">scheme=</span><span class="s">&quot;http://stackoverflow.com/feeds/tag?tagnames=android&amp;sort=newest/tags&quot;</span> <span class="na">term=</span><span class="s">&quot;file&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;author&gt;</span>
</span><span class='line'>            <span class="nt">&lt;name&gt;</span>cliff2310<span class="nt">&lt;/name&gt;</span>
</span><span class='line'>            <span class="nt">&lt;uri&gt;</span>http://stackoverflow.com/users/1128925<span class="nt">&lt;/uri&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/author&gt;</span>
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;alternate&quot;</span> <span class="na">href=</span><span class="s">&quot;http://stackoverflow.com/questions/9439999/where-is-my-data-file&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;published&gt;</span>2012-02-25T00:30:54Z<span class="nt">&lt;/published&gt;</span>
</span><span class='line'>        <span class="nt">&lt;updated&gt;</span>2012-02-25T00:30:54Z<span class="nt">&lt;/updated&gt;</span>
</span><span class='line'>        <span class="nt">&lt;summary</span> <span class="na">type=</span><span class="s">&quot;html&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;p&gt;</span>I have an Application that requires a data file...<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;/summary&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/entry&gt;</span>
</span><span class='line'>    <span class="nt">&lt;entry&gt;</span>
</span><span class='line'>    ...
</span><span class='line'>    <span class="nt">&lt;/entry&gt;</span>
</span><span class='line'>...
</span><span class='line'><span class="nt">&lt;/feed&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>在sample app中抽取了entry 标签与它的子标签 title, link,summary.</p>

<h2>Instantiate the Parser(实例化解析器)</h2>

<p>下一步就是实例化一个parser并开始解析的操作。请看下面的示例：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">StackOverflowXmlParser</span> <span class="o">{</span>
</span><span class='line'>    <span class="c1">// We don&#39;t use namespaces</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">ns</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="n">List</span> <span class="nf">parse</span><span class="o">(</span><span class="n">InputStream</span> <span class="n">in</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">XmlPullParserException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">XmlPullParser</span> <span class="n">parser</span> <span class="o">=</span> <span class="n">Xml</span><span class="o">.</span><span class="na">newPullParser</span><span class="o">();</span>
</span><span class='line'>            <span class="n">parser</span><span class="o">.</span><span class="na">setFeature</span><span class="o">(</span><span class="n">XmlPullParser</span><span class="o">.</span><span class="na">FEATURE_PROCESS_NAMESPACES</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
</span><span class='line'>            <span class="n">parser</span><span class="o">.</span><span class="na">setInput</span><span class="o">(</span><span class="n">in</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</span><span class='line'>            <span class="n">parser</span><span class="o">.</span><span class="na">nextTag</span><span class="o">();</span>
</span><span class='line'>            <span class="k">return</span> <span class="nf">readFeed</span><span class="o">(</span><span class="n">parser</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">in</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'> <span class="o">...</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Read the Feed(读取Feed)</h2>

<p>The readFeed() 实际上并没有处理feed的内容。它只是在寻找一个 &#8220;entry&#8221; 的标签作为递归（recursively）处理整个feed的起点。如果一个标签它不是&#8221;entry&#8221;, readFeed()方法会跳过它. 当整个feed都被递归处理后，readFeed() 会返回一个包含了entry标签（包括里面的数据成员）的 List 。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="n">List</span> <span class="nf">readFeed</span><span class="o">(</span><span class="n">XmlPullParser</span> <span class="n">parser</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">XmlPullParserException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">List</span> <span class="n">entries</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">parser</span><span class="o">.</span><span class="na">require</span><span class="o">(</span><span class="n">XmlPullParser</span><span class="o">.</span><span class="na">START_TAG</span><span class="o">,</span> <span class="n">ns</span><span class="o">,</span> <span class="s">&quot;feed&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="k">while</span> <span class="o">(</span><span class="n">parser</span><span class="o">.</span><span class="na">next</span><span class="o">()</span> <span class="o">!=</span> <span class="n">XmlPullParser</span><span class="o">.</span><span class="na">END_TAG</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">parser</span><span class="o">.</span><span class="na">getEventType</span><span class="o">()</span> <span class="o">!=</span> <span class="n">XmlPullParser</span><span class="o">.</span><span class="na">START_TAG</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">continue</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
</span><span class='line'>        <span class="c1">// Starts by looking for the entry tag</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;entry&quot;</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">entries</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">readEntry</span><span class="o">(</span><span class="n">parser</span><span class="o">));</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">skip</span><span class="o">(</span><span class="n">parser</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">entries</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Parse XML(解析XML)</h2>

<p>解析步骤如下：</p>

<ul>
<li>正如在上面“ 分析Feed”所说的, 判断出你想要的tag。这个example抽取了 entry 标签与它的内部标签 title, link,summary.</li>
<li>创建下面的方法:

<ul>
<li>为每一个你想要获取的标签创建一个 &#8220;read&#8221; 方法。例如 readEntry(), readTitle() 等等. 解析器从input stream中读取tag . 当读取到 entry, title, link 或者 summary 标签时，它会为那些标签调用相应的方法，否则，跳过这个标签。</li>
<li>为每一个不同的标签的提取数据方法进行优化，例如：

<ul>
<li>对于 title and summary tags, 解析器调用 readText(). 通过调用parser.getText().来获取返回数据。</li>
<li>对于 link tag,解析器先判断这个link是否是我们想要的类型，然后再读取数据。可以使用 parser.getAttributeValue() 来获取返回数据。</li>
<li>对于 entry tag, 解析起调用 readEntry(). 这个方法解析entry的内部标签并返回一个带有title, link, and summary数据成员的Entry对象。</li>
</ul>
</li>
<li>一个帮助方法： skip() . 关于这部分的讨论，请看下面一部分内容：Skip Tags You Don&#8217;t Care About</li>
</ul>
</li>
</ul>


<p>下面的代码演示了如何解析 entries, titles, links, 与 summaries.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Entry</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">link</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">summary</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="nf">Entry</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">,</span> <span class="n">String</span> <span class="n">summary</span><span class="o">,</span> <span class="n">String</span> <span class="n">link</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">;</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">summary</span> <span class="o">=</span> <span class="n">summary</span><span class="o">;</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">link</span> <span class="o">=</span> <span class="n">link</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Parses the contents of an entry. If it encounters a title, summary, or link tag, hands them off</span>
</span><span class='line'><span class="c1">// to their respective &quot;read&quot; methods for processing. Otherwise, skips the tag.</span>
</span><span class='line'><span class="kd">private</span> <span class="n">Entry</span> <span class="nf">readEntry</span><span class="o">(</span><span class="n">XmlPullParser</span> <span class="n">parser</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">XmlPullParserException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">parser</span><span class="o">.</span><span class="na">require</span><span class="o">(</span><span class="n">XmlPullParser</span><span class="o">.</span><span class="na">START_TAG</span><span class="o">,</span> <span class="n">ns</span><span class="o">,</span> <span class="s">&quot;entry&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="n">String</span> <span class="n">title</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>    <span class="n">String</span> <span class="n">summary</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>    <span class="n">String</span> <span class="n">link</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>    <span class="k">while</span> <span class="o">(</span><span class="n">parser</span><span class="o">.</span><span class="na">next</span><span class="o">()</span> <span class="o">!=</span> <span class="n">XmlPullParser</span><span class="o">.</span><span class="na">END_TAG</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">parser</span><span class="o">.</span><span class="na">getEventType</span><span class="o">()</span> <span class="o">!=</span> <span class="n">XmlPullParser</span><span class="o">.</span><span class="na">START_TAG</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">continue</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;title&quot;</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">title</span> <span class="o">=</span> <span class="n">readTitle</span><span class="o">(</span><span class="n">parser</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;summary&quot;</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">summary</span> <span class="o">=</span> <span class="n">readSummary</span><span class="o">(</span><span class="n">parser</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;link&quot;</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">link</span> <span class="o">=</span> <span class="n">readLink</span><span class="o">(</span><span class="n">parser</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">skip</span><span class="o">(</span><span class="n">parser</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">new</span> <span class="nf">Entry</span><span class="o">(</span><span class="n">title</span><span class="o">,</span> <span class="n">summary</span><span class="o">,</span> <span class="n">link</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Processes title tags in the feed.</span>
</span><span class='line'><span class="kd">private</span> <span class="n">String</span> <span class="nf">readTitle</span><span class="o">(</span><span class="n">XmlPullParser</span> <span class="n">parser</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">XmlPullParserException</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">parser</span><span class="o">.</span><span class="na">require</span><span class="o">(</span><span class="n">XmlPullParser</span><span class="o">.</span><span class="na">START_TAG</span><span class="o">,</span> <span class="n">ns</span><span class="o">,</span> <span class="s">&quot;title&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="n">String</span> <span class="n">title</span> <span class="o">=</span> <span class="n">readText</span><span class="o">(</span><span class="n">parser</span><span class="o">);</span>
</span><span class='line'>    <span class="n">parser</span><span class="o">.</span><span class="na">require</span><span class="o">(</span><span class="n">XmlPullParser</span><span class="o">.</span><span class="na">END_TAG</span><span class="o">,</span> <span class="n">ns</span><span class="o">,</span> <span class="s">&quot;title&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">title</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Processes link tags in the feed.</span>
</span><span class='line'><span class="kd">private</span> <span class="n">String</span> <span class="nf">readLink</span><span class="o">(</span><span class="n">XmlPullParser</span> <span class="n">parser</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">XmlPullParserException</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">String</span> <span class="n">link</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">;</span>
</span><span class='line'>    <span class="n">parser</span><span class="o">.</span><span class="na">require</span><span class="o">(</span><span class="n">XmlPullParser</span><span class="o">.</span><span class="na">START_TAG</span><span class="o">,</span> <span class="n">ns</span><span class="o">,</span> <span class="s">&quot;link&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="n">String</span> <span class="n">tag</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
</span><span class='line'>    <span class="n">String</span> <span class="n">relType</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="na">getAttributeValue</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="s">&quot;rel&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="n">tag</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;link&quot;</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">relType</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;alternate&quot;</span><span class="o">)){</span>
</span><span class='line'>            <span class="n">link</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="na">getAttributeValue</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="s">&quot;href&quot;</span><span class="o">);</span>
</span><span class='line'>            <span class="n">parser</span><span class="o">.</span><span class="na">nextTag</span><span class="o">();</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="n">parser</span><span class="o">.</span><span class="na">require</span><span class="o">(</span><span class="n">XmlPullParser</span><span class="o">.</span><span class="na">END_TAG</span><span class="o">,</span> <span class="n">ns</span><span class="o">,</span> <span class="s">&quot;link&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">link</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Processes summary tags in the feed.</span>
</span><span class='line'><span class="kd">private</span> <span class="n">String</span> <span class="nf">readSummary</span><span class="o">(</span><span class="n">XmlPullParser</span> <span class="n">parser</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">XmlPullParserException</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">parser</span><span class="o">.</span><span class="na">require</span><span class="o">(</span><span class="n">XmlPullParser</span><span class="o">.</span><span class="na">START_TAG</span><span class="o">,</span> <span class="n">ns</span><span class="o">,</span> <span class="s">&quot;summary&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="n">String</span> <span class="n">summary</span> <span class="o">=</span> <span class="n">readText</span><span class="o">(</span><span class="n">parser</span><span class="o">);</span>
</span><span class='line'>    <span class="n">parser</span><span class="o">.</span><span class="na">require</span><span class="o">(</span><span class="n">XmlPullParser</span><span class="o">.</span><span class="na">END_TAG</span><span class="o">,</span> <span class="n">ns</span><span class="o">,</span> <span class="s">&quot;summary&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">summary</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// For the tags title and summary, extracts their text values.</span>
</span><span class='line'><span class="kd">private</span> <span class="n">String</span> <span class="nf">readText</span><span class="o">(</span><span class="n">XmlPullParser</span> <span class="n">parser</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">XmlPullParserException</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">String</span> <span class="n">result</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">;</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="n">parser</span><span class="o">.</span><span class="na">next</span><span class="o">()</span> <span class="o">==</span> <span class="n">XmlPullParser</span><span class="o">.</span><span class="na">TEXT</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">result</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="na">getText</span><span class="o">();</span>
</span><span class='line'>        <span class="n">parser</span><span class="o">.</span><span class="na">nextTag</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>  <span class="o">...</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Skip Tags You Don&#8217;t Care About(跳过你不在意标签)</h2>

<p>下面演示解析器的 skip() 方法:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="kt">void</span> <span class="nf">skip</span><span class="o">(</span><span class="n">XmlPullParser</span> <span class="n">parser</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">XmlPullParserException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="n">parser</span><span class="o">.</span><span class="na">getEventType</span><span class="o">()</span> <span class="o">!=</span> <span class="n">XmlPullParser</span><span class="o">.</span><span class="na">START_TAG</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalStateException</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">depth</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
</span><span class='line'>    <span class="k">while</span> <span class="o">(</span><span class="n">depth</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">switch</span> <span class="o">(</span><span class="n">parser</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">case</span> <span class="n">XmlPullParser</span><span class="o">.</span><span class="na">END_TAG</span><span class="o">:</span>
</span><span class='line'>            <span class="n">depth</span><span class="o">--;</span>
</span><span class='line'>            <span class="k">break</span><span class="o">;</span>
</span><span class='line'>        <span class="k">case</span> <span class="n">XmlPullParser</span><span class="o">.</span><span class="na">START_TAG</span><span class="o">:</span>
</span><span class='line'>            <span class="n">depth</span><span class="o">++;</span>
</span><span class='line'>            <span class="k">break</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>上面这个方法是如何工作的呢？</p>

<ul>
<li>It throws an exception if the current event isn&#8217;t a START_TAG.</li>
<li>It consumes the START_TAG, and all events up to and including the matching END_TAG.</li>
<li>To make sure that it stops at the correct END_TAG and not at the first tag it encounters after the original START_TAG, it keeps track of the nesting depth.</li>
</ul>


<p>因此如果目前的标签有子标签, depth 的值就不会为 0，直到解析器已经处理了所有位于START_TAG与END_TAG之间的事件。例如，看解析器如何跳过 <author> 标签，它有2个子标签，<name> 与 <uri>：</p>

<ul>
<li>The first time through the while loop, the next tag the parser encounters after <author> is the START_TAG for <name>. The value for depth is incremented to 2.</li>
<li>The second time through the while loop, the next tag the parser encounters is the END_TAG </name>. The value for depth is decremented to 1.</li>
<li>The third time through the while loop, the next tag the parser encounters is the START_TAG <uri>. The value for depth is incremented to 2.</li>
<li>The fourth time through the while loop, the next tag the parser encounters is the END_TAG </uri>. The value for depth is decremented to 1.</li>
<li>The fifth time and final time through the while loop, the next tag the parser encounters is the END_TAG </author>. The value for depth is decremented to 0, indicating that the <author>element has been successfully skipped.</li>
</ul>


<h2>Consume XML Data(使用XML数据)</h2>

<p>示例程序是在 AsyncTask 中获取与解析XML数据的。当获取到数据后，程序会在main activity(NetworkActivity)里面进行更新操作。</p>

<p>在下面示例代码中，loadPage() 方法做了下面的事情：</p>

<ul>
<li>初始化一个带有URL地址的String变量，用来订阅XML feed。</li>
<li>如果用户设置与网络连接都允许，会触发 new DownloadXmlTask().execute(url). 这会初始化一个新的 DownloadXmlTask(AsyncTask subclass)  对象并且开始执行它的 execute() 方法。</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">NetworkActivity</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">WIFI</span> <span class="o">=</span> <span class="s">&quot;Wi-Fi&quot;</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">ANY</span> <span class="o">=</span> <span class="s">&quot;Any&quot;</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">URL</span> <span class="o">=</span> <span class="s">&quot;http://stackoverflow.com/feeds/tag?tagnames=android&amp;sort=newest&quot;</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Whether there is a Wi-Fi connection.</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="n">wifiConnected</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'>    <span class="c1">// Whether there is a mobile connection.</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="n">mobileConnected</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'>    <span class="c1">// Whether the display should be refreshed.</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="n">refreshDisplay</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">sPref</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">...</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Uses AsyncTask to download the XML feed from stackoverflow.com.</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">loadPage</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span><span class="o">((</span><span class="n">sPref</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">ANY</span><span class="o">))</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">wifiConnected</span> <span class="o">||</span> <span class="n">mobileConnected</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">new</span> <span class="nf">DownloadXmlTask</span><span class="o">().</span><span class="na">execute</span><span class="o">(</span><span class="n">URL</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="k">else</span> <span class="nf">if</span> <span class="o">((</span><span class="n">sPref</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">WIFI</span><span class="o">))</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">wifiConnected</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">new</span> <span class="nf">DownloadXmlTask</span><span class="o">().</span><span class="na">execute</span><span class="o">(</span><span class="n">URL</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>            <span class="c1">// show error</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>下面是DownloadXmlTask是怎么工作的：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">// Implementation of AsyncTask used to download XML feed from stackoverflow.com.</span>
</span><span class='line'><span class="kd">private</span> <span class="kd">class</span> <span class="nc">DownloadXmlTask</span> <span class="kd">extends</span> <span class="n">AsyncTask</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Void</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="o">{</span>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">protected</span> <span class="n">String</span> <span class="nf">doInBackground</span><span class="o">(</span><span class="n">String</span><span class="o">...</span> <span class="n">urls</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="nf">loadXmlFromNetwork</span><span class="o">(</span><span class="n">urls</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="nf">getResources</span><span class="o">().</span><span class="na">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">connection_error</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">XmlPullParserException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="nf">getResources</span><span class="o">().</span><span class="na">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">xml_error</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onPostExecute</span><span class="o">(</span><span class="n">String</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">main</span><span class="o">);</span>
</span><span class='line'>        <span class="c1">// Displays the HTML string in the UI via a WebView</span>
</span><span class='line'>        <span class="n">WebView</span> <span class="n">myWebView</span> <span class="o">=</span> <span class="o">(</span><span class="n">WebView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">webview</span><span class="o">);</span>
</span><span class='line'>        <span class="n">myWebView</span><span class="o">.</span><span class="na">loadData</span><span class="o">(</span><span class="n">result</span><span class="o">,</span> <span class="s">&quot;text/html&quot;</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>下面是loadXmlFromNetwork是怎么工作的：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">// Uploads XML from stackoverflow.com, parses it, and combines it with</span>
</span><span class='line'><span class="c1">// HTML markup. Returns HTML string.【这里可以看出应该是Download】</span>
</span><span class='line'><span class="kd">private</span> <span class="n">String</span> <span class="nf">loadXmlFromNetwork</span><span class="o">(</span><span class="n">String</span> <span class="n">urlString</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">XmlPullParserException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">InputStream</span> <span class="n">stream</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>    <span class="c1">// Instantiate the parser</span>
</span><span class='line'>    <span class="n">StackOverflowXmlParser</span> <span class="n">stackOverflowXmlParser</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StackOverflowXmlParser</span><span class="o">();</span>
</span><span class='line'>    <span class="n">List</span><span class="o">&lt;</span><span class="n">Entry</span><span class="o">&gt;</span> <span class="n">entries</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>    <span class="n">String</span> <span class="n">title</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>    <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>    <span class="n">String</span> <span class="n">summary</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>    <span class="n">Calendar</span> <span class="n">rightNow</span> <span class="o">=</span> <span class="n">Calendar</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
</span><span class='line'>    <span class="n">DateFormat</span> <span class="n">formatter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleDateFormat</span><span class="o">(</span><span class="s">&quot;MMM dd h:mmaa&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Checks whether the user set the preference to include summary text</span>
</span><span class='line'>    <span class="n">SharedPreferences</span> <span class="n">sharedPrefs</span> <span class="o">=</span> <span class="n">PreferenceManager</span><span class="o">.</span><span class="na">getDefaultSharedPreferences</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span><span class='line'>    <span class="kt">boolean</span> <span class="n">pref</span> <span class="o">=</span> <span class="n">sharedPrefs</span><span class="o">.</span><span class="na">getBoolean</span><span class="o">(</span><span class="s">&quot;summaryPref&quot;</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">StringBuilder</span> <span class="n">htmlString</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
</span><span class='line'>    <span class="n">htmlString</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&quot;&lt;h3&gt;&quot;</span> <span class="o">+</span> <span class="n">getResources</span><span class="o">().</span><span class="na">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">page_title</span><span class="o">)</span> <span class="o">+</span> <span class="s">&quot;&lt;/h3&gt;&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="n">htmlString</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&quot;&lt;em&gt;&quot;</span> <span class="o">+</span> <span class="n">getResources</span><span class="o">().</span><span class="na">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">updated</span><span class="o">)</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span>
</span><span class='line'>            <span class="n">formatter</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">rightNow</span><span class="o">.</span><span class="na">getTime</span><span class="o">())</span> <span class="o">+</span> <span class="s">&quot;&lt;/em&gt;&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">stream</span> <span class="o">=</span> <span class="n">downloadUrl</span><span class="o">(</span><span class="n">urlString</span><span class="o">);</span>
</span><span class='line'>        <span class="n">entries</span> <span class="o">=</span> <span class="n">stackOverflowXmlParser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">stream</span><span class="o">);</span>
</span><span class='line'>    <span class="c1">// Makes sure that the InputStream is closed after the app is</span>
</span><span class='line'>    <span class="c1">// finished using it.</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">stream</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">stream</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>     <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// StackOverflowXmlParser returns a List (called &quot;entries&quot;) of Entry objects.</span>
</span><span class='line'>    <span class="c1">// Each Entry object represents a single post in the XML feed.</span>
</span><span class='line'>    <span class="c1">// This section processes the entries list to combine each entry with HTML markup.</span>
</span><span class='line'>    <span class="c1">// Each entry is displayed in the UI as a link that optionally includes</span>
</span><span class='line'>    <span class="c1">// a text summary.</span>
</span><span class='line'>    <span class="k">for</span> <span class="o">(</span><span class="n">Entry</span> <span class="n">entry</span> <span class="o">:</span> <span class="n">entries</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">htmlString</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&quot;&lt;p&gt;&lt;a href=&#39;&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="n">htmlString</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">link</span><span class="o">);</span>
</span><span class='line'>        <span class="n">htmlString</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&quot;&#39;&gt;&quot;</span> <span class="o">+</span> <span class="n">entry</span><span class="o">.</span><span class="na">title</span> <span class="o">+</span> <span class="s">&quot;&lt;/a&gt;&lt;/p&gt;&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="c1">// If the user set the preference to include summary text,</span>
</span><span class='line'>        <span class="c1">// adds it to the display.</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">pref</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">htmlString</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">summary</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">htmlString</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Given a string representation of a URL, sets up a connection and gets</span>
</span><span class='line'><span class="c1">// an input stream. </span>
</span><span class='line'><span class="err">【关于</span><span class="n">Timeout</span><span class="err">具体应该设置多少，可以借鉴这里的数据，当然前提是一般情况下】</span>
</span><span class='line'><span class="c1">// Given a string representation of a URL, sets up a connection and gets</span>
</span><span class='line'><span class="c1">// an input stream.</span>
</span><span class='line'><span class="kd">private</span> <span class="n">InputStream</span> <span class="nf">downloadUrl</span><span class="o">(</span><span class="n">String</span> <span class="n">urlString</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">URL</span> <span class="n">url</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="n">urlString</span><span class="o">);</span>
</span><span class='line'>    <span class="n">HttpURLConnection</span> <span class="n">conn</span> <span class="o">=</span> <span class="o">(</span><span class="n">HttpURLConnection</span><span class="o">)</span> <span class="n">url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">();</span>
</span><span class='line'>    <span class="n">conn</span><span class="o">.</span><span class="na">setReadTimeout</span><span class="o">(</span><span class="mi">10000</span> <span class="cm">/* milliseconds */</span><span class="o">);</span>
</span><span class='line'>    <span class="n">conn</span><span class="o">.</span><span class="na">setConnectTimeout</span><span class="o">(</span><span class="mi">15000</span> <span class="cm">/* milliseconds */</span><span class="o">);</span>
</span><span class='line'>    <span class="n">conn</span><span class="o">.</span><span class="na">setRequestMethod</span><span class="o">(</span><span class="s">&quot;GET&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="n">conn</span><span class="o">.</span><span class="na">setDoInput</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span><span class='line'>    <span class="c1">// Starts the query</span>
</span><span class='line'>    <span class="n">conn</span><span class="o">.</span><span class="na">connect</span><span class="o">();</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">conn</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<hr />

<p><strong>学习自：<a href="http://developer.android.com/training/basics/network-ops/xml.html">http://developer.android.com/training/basics/network-ops/xml.html</a>，请多指教，谢谢！</strong><br/>
<strong>转载请注明出自<a href="http://kesenhoo.github.com">http://kesenhoo.github.com</a>，谢谢配合！</strong></p>
</div>


  <footer>
    <p><img src="http://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" alt="" title="" type="image/png"><br>
    <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">知识共享许可协议</a>：本站作品由<a href="http://hukai.me" target="_blank">HuKai</a>创作，采用<a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">知识共享 署名-非商业性使用-相同方式共享 4.0 国际 许可协议</a>进行许可。
    <br>如果你觉得这篇文章对你有帮助，请点击下面的分享链接，你还可以选择扫描二维码进行打赏!</br>
    <img src="/images/pay2me.jpg" alt=""/>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">HuKai</span></span>

      








  


<time datetime="2012-05-07T17:05:00+08:00" pubdate data-updated="true">May 7<span>th</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/android/'>Android</a>, <a class='category' href='/blog/categories/android-training/'>Android:Training</a>
  
</span>


    </p>
    
    
      <div class="sharing">
  
  
  
  
	<!-- JiaThis Button BEGIN -->
<div class="jiathis_style_32x32">
	<a class="jiathis_button_qzone"></a>
	<a class="jiathis_button_tsina"></a>
	<a class="jiathis_button_tqq"></a>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_googleplus"></a>
	<a class="jiathis_button_renren"></a>
	<a class="jiathis_button_linkedin"></a>
	<a class="jiathis_button_douban"></a>
	<a href="http://www.jiathis.com/share?uid=1723296" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript">
var jiathis_config = {data_track_clickback:'true'};
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1342501457879302" charset="utf-8"></script>
<!-- JiaThis Button END -->
  
  
</div>

    
    <br></br>
    
    <p class="meta">
      
        <a class="basic-alignment left" href="/android-training-network-operations-lesson-2/" title="Previous Post: Android Training - 执行网络操作(Lesson 2 - 管理网络使用方法)">&laquo; Android Training - 执行网络操作(Lesson 2 - 管理网络使用方法)</a>
      
      
        <a class="basic-alignment right" href="/android-training-building-a-dynamic-ui-with-fragments-lesson-0/" title="Next Post: Android Training - 使用Fragments建立动态的UI(Lesson 0 - 章节概览)">Android Training - 使用Fragments建立动态的UI(Lesson 0 - 章节概览) &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>


</div>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2018 - HuKai -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> - 本站作品采用 <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享 署名-非商业性使用-相同方式共享 4.0 国际 许可协议</a>进行许可.</span> 
  
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'kesenhoo';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://hukai.me/android-training-network-operations-lesson-3/';
        var disqus_url = 'http://hukai.me/android-training-network-operations-lesson-3/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
